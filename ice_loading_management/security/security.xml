<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">
        <!-- ========================================
             SECURITY GROUPS
             ======================================== -->
        
        <!-- Ice Loading Management Category -->
        <record id="module_category_ice_loading" model="ir.module.category">
            <field name="name">Ice Loading Management</field>
            <field name="description">Manage ice loading operations and fleet</field>
            <field name="sequence">15</field>
        </record>

        <!-- Fleet Supervisor Group -->
        <record id="group_fleet_supervisor" model="res.groups">
            <field name="name">Fleet Supervisor</field>
            <field name="category_id" ref="module_category_ice_loading"/>
            <field name="comment">Can change cars in loading requests, manage fleet operations, print and upload loading forms</field>
        </record>

        <!-- Loading Worker Group -->
        <record id="group_loading_worker" model="res.groups">
            <field name="name">Loading Worker</field>
            <field name="category_id" ref="module_category_ice_loading"/>
            <field name="comment">Can assist in loading operations, view assigned tasks</field>
        </record>

        <!-- Freezer Supervisor Group -->
        <record id="group_freezer_supervisor" model="res.groups">
            <field name="name">Freezer Supervisor</field>
            <field name="category_id" ref="module_category_ice_loading"/>
            <field name="comment">Can make decisions about freezer loading readiness, print and upload freezer release forms</field>
        </record>

        <!-- Loading Coordinator Group -->
        <record id="group_loading_coordinator" model="res.groups">
            <field name="name">Loading Coordinator</field>
            <field name="category_id" ref="module_category_ice_loading"/>
            <field name="comment">Can coordinate loading operations, view all requests, manage priorities</field>
        </record>

        <!-- Driver Group -->
        <record id="group_driver" model="res.groups">
            <field name="name">Driver</field>
            <field name="category_id" ref="module_category_ice_loading"/>
            <field name="comment">Can manage driver sessions, view assigned loading requests</field>
        </record>

        <!-- ========================================
             RECORD RULES
             ======================================== -->
        
        <!-- Loading Request Rules -->
        <!-- <record id="loading_request_rule_own_requests" model="ir.rule">
            <field name="name">Loading Request: Own Requests</field>
            <field name="model_id" ref="model_ice_loading_request"/>
            <field name="domain_force">['|', ('salesman_id', '=', user.id), ('team_leader_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('sales_team.group_sale_salesman'))]"/>
        </record> -->
        <!-- <record id="loading_request_rule_loading_worker" model="ir.rule">
            <field name="name">Loading Request: Loading Worker Access</field>
            <field name="model_id" ref="model_ice_loading_request"/>
            <field name="domain_force">[('state', '=', 'ready_for_loading')]</field>
            <field name="groups" eval="[(4, ref('group_loading_worker'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record> -->


        <record id="loading_request_rule_supervisors" model="ir.rule">
            <field name="name">Loading Request: Supervisors Full Access</field>
            <field name="model_id" ref="model_ice_loading_request"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('sales_team.group_sale_manager')),
                                        (4, ref('group_fleet_supervisor')),
                                        (4, ref('group_freezer_supervisor')),
                                        (4, ref('group_loading_coordinator')),
                                        (4, ref('stock.group_stock_manager'))]"/>
        </record>

        <!-- Driver Session Rules -->
        <record id="driver_session_rule_own_sessions" model="ir.rule">
            <field name="name">Driver Session: Own Sessions</field>
            <field name="model_id" ref="model_ice_driver_session"/>
            <field name="domain_force">[('driver_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('group_driver'))]"/>
        </record>

        <record id="driver_session_rule_supervisors" model="ir.rule">
            <field name="name">Driver Session: Supervisors Full Access</field>
            <field name="model_id" ref="model_ice_driver_session"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_fleet_supervisor')),
                                        (4, ref('group_loading_coordinator'))]"/>
        </record>

        <!-- Loading Place Rules -->
        <record id="loading_place_rule_read_all" model="ir.rule">
            <field name="name">Loading Place: Read All</field>
            <field name="model_id" ref="model_ice_loading_place"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <record id="loading_place_rule_manage" model="ir.rule">
            <field name="name">Loading Place: Manage</field>
            <field name="model_id" ref="model_ice_loading_place"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('sales_team.group_sale_manager')),
                                        (4, ref('group_fleet_supervisor')),
                                        (4, ref('group_loading_coordinator'))]"/>
        </record>

        <!-- Product Line Rules -->
        <record id="product_line_rule_request_access" model="ir.rule">
            <field name="name">Product Line: Request Access</field>
            <field name="model_id" ref="model_ice_loading_product_line"/>
            <field name="domain_force">['|', ('loading_request_id.salesman_id', '=', user.id), 
                                       ('loading_request_id.team_leader_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('sales_team.group_sale_salesman'))]"/>
        </record>

        <record id="product_line_rule_supervisors" model="ir.rule">
            <field name="name">Product Line: Supervisors Full Access</field>
            <field name="model_id" ref="model_ice_loading_product_line"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('sales_team.group_sale_manager')),
                                        (4, ref('group_fleet_supervisor')),
                                        (4, ref('group_freezer_supervisor')),
                                        (4, ref('group_loading_coordinator')),
                                        (4, ref('stock.group_stock_manager'))]"/>
        </record>

        <!-- Freezer Line Rules -->
        <!-- <record id="freezer_line_rule_request_access" model="ir.rule">
            <field name="name">Freezer Line: Request Access</field>
            <field name="model_id" ref="model_ice_loading_freezer_line"/>
            <field name="domain_force">['|', ('loading_request_id.salesman_id', '=', user.id), 
                                       ('loading_request_id.team_leader_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('sales_team.group_sale_salesman'))]"/>
        </record> -->

        <!-- <record id="freezer_line_rule_supervisors" model="ir.rule">
            <field name="name">Freezer Line: Supervisors Full Access</field>
            <field name="model_id" ref="model_ice_loading_freezer_line"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('sales_team.group_sale_manager')),
                                        (4, ref('group_fleet_supervisor')),
                                        (4, ref('group_freezer_supervisor')),
                                        (4, ref('group_loading_coordinator')),
                                        (4, ref('stock.group_stock_manager'))]"/>
        </record> -->

        <!-- ========================================
             FIELD-LEVEL SECURITY (REMOVED - CAUSING ERROR)
             ======================================== -->
        
        <!-- Note: Field-level security is handled through view modifications and group permissions
             rather than creating ir.model.fields records which require ttype -->

        <!-- ========================================
             WORKFLOW CONSTRAINTS
             ======================================== -->
        
        <!-- State Transition Rules -->
        <!-- <record id="workflow_rule_car_checking_to_ready" model="ir.rule">
            <field name="name">Workflow: Car Checking to Ready</field>
            <field name="model_id" ref="model_ice_loading_request"/>
            <field name="domain_force">[('state', '=', 'car_checking')]</field>
            <field name="groups" eval="[(4, ref('maintenance.group_equipment_manager'))]"/>
        </record> -->

        <!-- <record id="workflow_rule_ready_to_loaded" model="ir.rule">
            <field name="name">Workflow: Ready to Loaded</field>
            <field name="model_id" ref="model_ice_loading_request"/>
            <field name="domain_force">[('state', '=', 'ready_for_loading')]</field>
            <field name="groups" eval="[(4, ref('stock.group_stock_manager'))]"/>
        </record> -->

        <!-- <record id="workflow_rule_loaded_to_freezer_loaded" model="ir.rule">
            <field name="name">Workflow: Loaded to Freezer Loaded</field>
            <field name="model_id" ref="model_ice_loading_request"/>
            <field name="domain_force">[('state', '=', 'ice_handled')]</field>
            <field name="groups" eval="[(4, ref('stock.group_stock_manager')), (4, ref('group_freezer_supervisor'))]"/>
        </record> -->

        <!-- ========================================
             AUTOMATED ACTIONS SECURITY
             ======================================== -->
        
        <!-- Notification Groups -->
        <record id="group_notification_recipients" model="res.groups">
            <field name="name">Notification Recipients</field>
            <field name="category_id" ref="module_category_ice_loading"/>
            <field name="comment">Users who receive automatic notifications from the ice loading system</field>
        </record>

        <!-- Form Management Groups -->
        <record id="group_form_print_access" model="res.groups">
            <field name="name">Form Print Access</field>
            <field name="category_id" ref="module_category_ice_loading"/>
            <field name="comment">Can print loading and release forms</field>
            <field name="implied_ids" eval="[(4, ref('group_fleet_supervisor')), (4, ref('group_freezer_supervisor'))]"/>
        </record>

        <record id="group_form_upload_access" model="res.groups">
            <field name="name">Form Upload Access</field>
            <field name="category_id" ref="module_category_ice_loading"/>
            <field name="comment">Can upload signed forms and change request status</field>
            <field name="implied_ids" eval="[(4, ref('group_fleet_supervisor')), (4, ref('group_freezer_supervisor'))]"/>
        </record>

        <!-- ========================================
             COMPANY-SPECIFIC RULES (REMOVED - COMPANY_ID DOESN'T EXIST)
             ======================================== -->
        
        <!-- Note: Multi-company rules removed as company_id field is not implemented
             in ice.loading.request model. Can be added later if needed. -->

        <!-- ========================================
             DEFAULT GROUP ASSIGNMENTS (SIMPLIFIED)
             ======================================== -->
        
        <!-- Note: Simplified group assignments to avoid dependency issues during installation -->

    </data>
</odoo>